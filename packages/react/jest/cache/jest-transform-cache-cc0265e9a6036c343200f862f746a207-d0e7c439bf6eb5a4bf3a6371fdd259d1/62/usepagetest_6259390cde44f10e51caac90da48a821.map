{"file":"/Users/jiangwei/projects/lotips/packages/react/test/use-page.test.ts","mappings":"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","names":[],"sources":["/Users/jiangwei/projects/lotips/packages/react/test/use-page.test.ts"],"sourcesContent":["import { usePage } from '../src/use-page'\nimport { renderHook, act } from '@testing-library/react-hooks'\n\ndescribe('use-page', () => {\n  test('default state should work fine', () => {\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          return { data: [1], total: 3 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n    expect(hook.result.current.state).toMatchObject({\n      data: [],\n      selected: [],\n      ids: [],\n      pages: 0,\n      limit: 10,\n      total: 0,\n      current: 1,\n      dataKey: 'id',\n      entries: {},\n      filter: { text: '' },\n    })\n  })\n\n  test('reinit should work fine', async () => {\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          return { data: [{ id: 1 }], total: 100 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n\n    hook.result.current.dispatch.handleReinit()\n    await hook.waitForNextUpdate()\n    expect(hook.result.current.state.data).toMatchObject([{ id: 1 }])\n    expect(hook.result.current.state.pages).toBe(10)\n  })\n\n  test('set filter should work in debounce mode', async () => {\n    let cnt = 0\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          cnt += 1\n          return { data: [{ id: 1 }], total: 100 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n\n    Array(10)\n      .fill(0)\n      .forEach(v => {\n        hook.result.current.dispatch.handleClearFilter()\n      })\n    await hook.waitForNextUpdate()\n    expect(cnt).toBe(1)\n  })\n\n  test('filter clear & set should work fine', () => {\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          return { data: [{ id: 1 }], total: 100 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n    hook.result.current.dispatch.handleClearFilter()\n    expect(hook.result.current.state.filter).toBe(undefined)\n    hook.result.current.dispatch.handleSetFilter({ text: '1' })\n    expect(hook.result.current.state.filter).toMatchObject({ text: '1' })\n    hook.result.current.dispatch.handleSetFilterByField('text', '2')\n    expect(hook.result.current.state.filter).toMatchObject({ text: '2' })\n  })\n\n  test('next, prev, go should change current correct', async () => {\n    let cnt = 0\n    const list = [{ id: 0 }, { id: 1 }, { id: 2 }, { id: 3 }]\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          cnt += 1\n          return { data: [list[cnt]], total: 100 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n    hook.result.current.dispatch.handleGo(1)\n    expect(hook.result.current.state.current).toBe(1)\n    hook.result.current.dispatch.handlePrev()\n    expect(hook.result.current.state.current).toBe(0)\n    hook.result.current.dispatch.handleNext(1)\n    expect(hook.result.current.state.current).toBe(1)\n    expect(cnt).toBe(3)\n  })\n\n  test('next, prev, go should change current correct', async () => {\n    let cnt = 0\n    const list = [{ id: 0 }, { id: 1 }, { id: 2 }, { id: 3 }]\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          cnt += 1\n          return { data: [list[cnt]], total: 100 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n    hook.result.current.dispatch.handleGo(1)\n    await hook.waitForNextUpdate()\n    hook.result.current.dispatch.handlePrev()\n    await hook.waitForNextUpdate()\n    hook.result.current.dispatch.handleNext(1)\n    expect(cnt).toBe(3)\n    await hook.waitForNextUpdate()\n    expect(hook.result.current.state.data).toMatchObject([{ id: 1 }, { id: 2 }, { id: 3 }])\n  })\n\n  test('status should change correct', async () => {\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          return { data: [{ id: 0 }], total: 100 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n    hook.result.current.dispatch.handleGo(1)\n    expect(hook.result.current.state.status).toBe('loading')\n    await hook.waitForNextUpdate()\n    expect(hook.result.current.state.status).toBe('loaded')\n  })\n\n  test('set selected should work fine', () => {\n    const hook = renderHook(() =>\n      usePage({\n        api: async (params: { skip: number; limit: number; filter: { text: string } }) => {\n          return { data: [{ id: '1' }], total: 100 }\n        },\n        defaultFilter: { text: '' },\n        limit: 10,\n        dataKey: 'id',\n      }),\n    )\n    expect(hook.result.current.state.selected).toMatchObject([])\n    hook.result.current.dispatch.setSelect(['1'])\n    expect(hook.result.current.state.selected).toMatchObject(['1'])\n  })\n})\n"],"version":3}